
<div class="container-pagemover mx-5 px-5 pt-2">
  <%= link_to '<< Back', url_for(:back), class: "link-color" %>

</div>

<div class="container-fluid">
  <div class="row mx-5 p-5 no-margin container-show-card mx-auto">
    <div class="col-md-7">
      <div class="justify-content-between py-4">
        <div class="row-title d-flex justify-content-between">
          <h2> <%= @meal.name %> </h2> <p>$<%= @meal.price %></p>
        </div>
        <div class="stars-avg-rating d-flex justify-content-between" > <p><%= @meal.check_rating(@meal.average_rating) %> <%= @meal.display_rating_count(@meal.reviews.count) %></p>

        <!-- # Authorization for editing and deleting meal -->
        <% if current_user == @meal.user  %>
          <div class="icon-font d-flex justify-content-end">
            <button class="btn btn-2 btn-light" type="submit" style="margin-left: 8px">
            <%= link_to 'Edit', edit_meal_path, class: "link-color" %></button>
            <button id="sweet-alert-demo" class="btn btn-danger"><i class="fas fa-trash"></i></button>
            <%= link_to "", meal_path(@meal)  , method: :delete, id:"delete-link", class: "hidden" %>
          </div>
        <% end %>

        </div>
<!--         <div class="rating-block">
          <h4 class="bold padding-bottom-7">
            <span class="<%#= @meal.class_colors %>"><%#= @meal.average_rating %></span><small>/ 5</small></h4>
        </div> -->

        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
          <% count = @meal.mealphotos.count %>
          <% if count > 1 %>
          <% item = 1 %>
          <% while item <= count %>
            <li data-target="#carouselExampleIndicators" data-slide-to='#{item}'></li>
            <% item+=1 %>
            <% end %>
            <% end %>
        </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <%= cl_image_tag @meal.mealphotos[0].photo, class: "d-block w-100", style: "width:100%; height: 60vh" , crop: :fill %>
            </div>
              <% @meal.mealphotos[1..-1].each do |c| %>
              <div class="carousel-item">
                <%= cl_image_tag c.photo, class: "d-block w-100", style: "width:100%; height: 60vh" , crop: :fill; %>
              </div>
            <% end %>
          </div>
            <% if count > 1 %>
          <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
          <% end %>
        </div>
      </div>
      <div class="filter-container ml-0">
        <p><% @meal.cuisine_tags.each do |cuisine| %>
          <%= link_to cuisine.name, meals_path(query: cuisine.name), class: "btn btn-hover cuisine-taggy" %>
          <% end %>
          <% @meal.diet_tags.each do |diet| %>
          <%= link_to diet.name, meals_path(query: diet.name), class: "btn btn-hover cuisine-taggy" %>
          <% end %>
        </p>
      </div>

<!-- Review form -->



<!-- Review form end -->
    <div class="container-review mt-3">
      <div class="row-review">
        <div class="col-xs-4">
          <h3>Leave a review!</h3>
          <%= simple_form_for ([@meal, @review]) do |f| %>
            <%= f.input :rating, collection: (1..5).to_a, label: "Rate your experience" %>
            <%= f.input :content, label: "Say something", class: "form-review" %>
            <%= f.submit "Submit", class: "btn btn-outline-danger", style: "border-radius: 4px;" %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="nav-tabs-reviews p-2 my-3">
      <% if @meal.reviews.count > 0 %>
      <h4>Comments</h4>
      <div class="tab-content">
        <div class="tab-pane fade show active">
          <!-- review 1 -->
          <% @meal.reviews.each do |r| %>
            <div class="review mt-0">
            <!-- box avatar/name + rating overall -->
              <div class='review-top d-flex justify-content-between border-shadow mt-0 pt-0 mb-2'>
              <!-- box avatar and name -->
                <div class="avatar-name d-flex justify-content-start ">
                  <%= cl_image_tag(r.user.avatar.url, class: "avatar-review" ) %>

                  <p class="my-auto ml-3"> <%= r.user.first_name %> </p>
                </div>
                <div class="my-auto" style="color: yellow">
                  <p> <%= r.display_ratings %></p>
                </div>

              </div>
              <em> "<%= r.content %>"</em>
            </div>

          <% end %>

          <!-- # Need to add review edit/delete buttons  -->
 <!--  -->
          <!-- review 2 -->
          <!-- implement review -->
        </div>
      </div>
       <% end %>
    </div>
  </div>

  <div class="col-md-5 justify-content-between py-4">
    <div class="instagram-container">
    <div class="row-title-resto">
      <div>
      <h2>
        <%= @meal.restaurant.name %> </h2><p><%=@meal.restaurant.address %></p>
        <div class="d-flex justify-content-between">
        <p><%= link_to nil, @meal.restaurant.website_url, class: "link-color", :target => "_blank" %></p>
        <p><%= link_to "@#{@meal.restaurant.instagram_handle}", "http://instagram.com/#{@meal.restaurant.instagram_handle}", class: "link-color", :target => "_blank" %></p>
        </div>
        </div>
    </div>
      <div class="cards-resto">
        <% @photos.each do |photo| %>
          <%= image_tag photo %>
        <% end %>
      </div>
    </div>
       <div class="other-meals-container ml-4">
        <div class="restaurant-name-container">
        <h4>Check out some of <%= @meal.restaurant.name %>'s other top dishes.</h4>
        </div>
        <div class="card-trip">
            <% m1 = @meals.sample %>
            <% m1.mealphotos.each do |photo| %>
            <%= image_tag photo.photo.url %>
            <% end %>
        <div class="card-trip-infos">
          <div>
            <h2><%= m1.name %></h2>
            <p><%= m1.restaurant.name %></p>
          </div>
          <h2 class="card-trip-pricing"><% m1.price %></h2>
        </div>
      </div>
        <div class="card-trip">
            <% m2 = @meals.sample %>
            <% m2.mealphotos.each do |photo| %>
            <%= image_tag photo.photo.url %>
            <% end %>
        <div class="card-trip-infos">
          <div>
            <h2><%= m2.name %></h2>
            <p><%= m2.restaurant.name %></p>
          </div>
          <h2 class="card-trip-pricing"><% m2.price %></h2>
        </div>
      </div>
        <div class="card-trip">
            <% m3 = @meals.sample %>
            <% m3.mealphotos.each do |photo| %>
            <%= image_tag photo.photo.url %>
            <% end %>
        <div class="card-trip-infos">
          <div>
            <h2><%= m3.name %></h2>
            <p><%= m3.restaurant.name %></p>
          </div>
          <h2 class="card-trip-pricing"><% m3.price %></h2>
        </div>
      </div>
    </div>
  </div>

</div>



